<template>
    <template if:true={showLoading}>
        <lightning-spinner class="spinnerIcon" alternative-text="Loading..." variant="brand" size="medium"></lightning-spinner>
    </template>
    <template if:false={showLoading}>
        <article class="slds-card invoiceConfig">
            <div class="slds-card__header slds-grid">
                <header class="slds-media slds-media_center slds-has-flexi-truncate">
                    <lightning-icon icon-name="utility:setup" 
                                    alternative-text="Invoice Configuration" 
                                    class="iconColor"></lightning-icon>
                    <div class="slds-media__body">
                        <h2 class="slds-card__header-title slds-var-m-left_small">
                            <a class="slds-card__header-link slds-truncate" title="Invoice Configuration">
                                <span>{componentTitle}</span>
                            </a>
                        </h2>
                    </div>
                </header>
            </div>
            <div class="slds-card__body slds-card__body_inner">
                <div class="slds-section-title_divider slds-var-m-top_medium slds-var-m-bottom_medium">
                    {subTitleOne}
                </div>
                <div>
                    <p>
                        <lightning-icon icon-name="utility:info_alt" 
                                        alternative-text="info" 
                                        size="small" 
                                        title="Object & Fields to store Customer"></lightning-icon>
                        &nbsp;&nbsp;
                        {headingOne}
                    </p>
                </div>
                <div class="slds-var-m-top_medium objectSelection">
                    <template if:true={showInvoicePicklist}>
                        <c-multi-select-pick-list style="width: 30%;" 
                                                    onselectoption={handleInvoiceSelectedOption} 
                                                    options={invoiceOptions} 
                                                    selected-value={invoiceObjectSelected} 
                                                    placeholder-data="Please Select Invoice Object"
                                                    label="Search and Select Object to store Invoice"
                                                    elementname = 'Invoice'></c-multi-select-pick-list>
                    
                        <lightning-button if:true={invoiceObjectSelected} 
                                        variant="brand" 
                                        label="Invoice Field Map" 
                                        title="Invoice Field Map" 
                                        onclick={mapInvoiceFields} 
                                        class="slds-var-m-left_medium slds-var-m-top_large buttonColor"></lightning-button>
                    </template>
                </div>
                <div class="slds-var-p-top_medium objectSelection">
                <template if:true={invoiceObjectSelected}>
                        <!-- <template if:true={showLineItemPicklist}> -->
                            <c-multi-select-pick-list style="width: 30%;" 
                                                    onselectoptionnew ={handleLineItemNew} 
                                                    onselectoption={handleLineItemSelectOption} 
                                                    options={lineitemOptions} 
                                                    selected-value={lineitemObjectSelected} 
                                                    placeholder-data="Please Select LineItem Object"
                                                    label="Search and Select Object to store LineItem"
                                                    elementname = 'Lineitem'></c-multi-select-pick-list>
                            <lightning-button if:true={lineitemObjectSelected} 
                                                variant="brand" 
                                                label="LineItem Field Map" 
                                                title="LineItem Field Map" 
                                                onclick={mapLineItemFields} 
                                                class="slds-var-m-left_medium slds-var-m-top_large buttonColor"></lightning-button>
                        <!-- </template> -->
                    </template>
                </div>
            </div>
            <div class="slds-align_absolute-center">
                <lightning-button variant="brand" 
                                  label="Save" 
                                  title="Save"  
                                  onclick={handleSave}
                                  disabled={disableSave}
                                  class="slds-var-m-around_large buttonColor"></lightning-button>
            </div>
            <!-- Added NOW -->
            <div class="slds-card__body slds-card__body_inner">
                <div class="slds-section-title_divider slds-var-m-top_medium slds-var-m-bottom_medium">
                    {subTitleTwo}
                </div>
                <div>
                    <p>
                        <lightning-icon icon-name="utility:info_alt" 
                                        alternative-text="info" 
                                        size="small" 
                                        title="Click on the sync button to following items and metatdata from MYOB to Salesforce"></lightning-icon>
                        &nbsp;&nbsp;
                        {headingTwo}
                    </p>
                </div>
             <template if:true={mappingConfirmation}>
                    <div class="slds-var-m-top_medium objectSelection"><h1 style="padding-top: 4px; padding-left: 35px; font-weight: bold; font-size: 1.2em;" class="slds-var-p-top_x-small">Tax Codes</h1>
                        <lightning-button name="taxcodes" style="margin-left: 15px;" class="buttonColor" label="Sync" icon-position="right" variant="brand" icon-name="utility:refresh" alternative-text="Refresh Tax Code" onclick={handleRefresh}></lightning-button>
                    <!-- <lightning-button-icon name="taxcodes" icon-name="utility:refresh" variant="brand"
									alternative-text="Refresh Tax Code"  class="slds-var-m-left_medium buttonColor"
									onclick={handleRefresh}></lightning-button-icon> -->
                    </div>
              </template>
            </div>
        </article>
        <!-- modal popup -->
        <template if:true={isModalOpen}>
            <!-- Modal/Popup Box LWC starts here -->
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <!-- Modal/Popup Box LWC header here -->
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={cancelModal}>
                            <lightning-icon icon-name="utility:close"
                                            alternative-text="close"
                                            variant="inverse"
                                            size="small" ></lightning-icon>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">{modalHeader}</h2>
                    </header>
                    <!-- Modal/Popup Box LWC body starts here -->
                    <div class="slds-modal__content slds-var-p-around_medium" id="modal-content-id-1">
                        <table>
                        <thead>
                            <tr>
                                <th style="font-size: 14px;">MYOB Fields</th>
                                <th style="font-size: 14px;">Salesforce {selectObjectLabel} Fields</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th colspan="3">
                                    <div class="slds-text-title_bold" style="font-weight: 400; color:red">
                                        <lightning-icon class="noteReadonlyIcon slds-var-p-right_xx-small" 
                                                        icon-name="utility:lock" 
                                                        size="x-small" 
                                                        alternative-text="Locked field"></lightning-icon>
                                        : Fields with the lock icon are read-only and uneditable. These fields are not considered while syncing from SF to MYOB.
                                    </div>
                                </th>
                            </tr>
                            <template for:each={MYOBFields} for:item="fld">
                                <tr key={fld.name}>
                                    <td><template if:true={fld.require}><span style="color:red;">* </span></template>
                                    <template if:true={fld.readOnly}>
                                        <lightning-icon icon-name="utility:lock" 
                                                        size="xx-small" 
                                                        alternative-text="Read-only field" 
                                                        class="readonlyClass"></lightning-icon>
                                    </template>
                                    {fld.label} <lightning-helptext if:true={fld.helpText} content={fld.helpText} ></lightning-helptext>
                                    </td>
                                    <!-- <td><template if:true={fld.readOnly}><lightning-icon icon-name="utility:read_only" size="small" alternative-text="Read-only field"></lightning-icon></template>{fld.label}</td> -->
                                    <td>
                                    <template if:true={fld.options}>
                                        <lightning-combobox name={fld.value} 
                                                            data-configname={fld.name}
                                                            label={fld.label}
                                                            placeholder="Select Fields"
                                                            value={fld.value}
                                                            variant="label-hidden" 
                                                            options={fld.options} 
                                                            onchange={handleFieldChange}></lightning-combobox>
                                    </template>
                                    <template if:false={fld.options}>
                                        <p class="slds-text-color_error">No field of type <span style="text-transform: uppercase;">{fld.type}</span> is currently present. Please create a new field.</p>
                                    </template>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                    </div>
                    <!-- Modal/Popup Box LWC footer starts here -->
                    <footer class="slds-modal__footer" style="text-align: center;">
                        <button class="slds-button slds-button_brand buttonColor" onclick={clearMapping} title="CLear the Mapping">Clear</button> 
                        <button class="slds-button slds-button_brand buttonColor" onclick={closeModal} title="Continue with the Mapping">Continue</button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>
    </template>
</template>